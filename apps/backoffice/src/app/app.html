<div class="app-container">
  <!-- Login Form Overlay -->
  @if (showLoginForm() && !isAuthenticated()) {
    <div class="login-overlay">
      <mat-card class="login-card">
        <mat-card-header>
          <mat-card-title class="login-title">
            <mat-icon class="login-icon">business</mat-icon>
            VNCompare Backoffice
          </mat-card-title>
          <mat-card-subtitle>Sign in to access your dashboard</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <form class="login-form" (ngSubmit)="login(loginCredentials)" #loginForm="ngForm">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email Address</mat-label>
              <input 
                matInput
                type="email" 
                name="email"
                [(ngModel)]="loginCredentials.email"
                required
                placeholder="Enter your email">
              <mat-icon matSuffix>email</mat-icon>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Password</mat-label>
              <input 
                matInput
                type="password" 
                name="password"
                [(ngModel)]="loginCredentials.password"
                required
                placeholder="Enter your password">
              <mat-icon matSuffix>lock</mat-icon>
            </mat-form-field>
            
            <button 
              mat-raised-button 
              color="primary" 
              type="submit" 
              class="login-button"
              [disabled]="!loginForm.valid || loading()">
              <mat-icon>login</mat-icon>
              @if (loading()) {
                Signing In...
              } @else {
                Sign In
              }
            </button>
            
            @if (error()) {
              <div class="error-message">
                <mat-icon>error</mat-icon>
                {{ error() }}
              </div>
            }
          </form>
        </mat-card-content>
        
        <mat-card-footer>
          <div class="demo-credentials">
            <h4>
              <mat-icon>info</mat-icon>
              Demo Credentials
            </h4>
            <div class="credential-list">
              <div class="credential-item">
                <mat-icon class="credential-icon">admin_panel_settings</mat-icon>
                <div>
                  <strong>Admin:</strong> admin@vncompare.com / password123
                </div>
              </div>
              <div class="credential-item">
                <mat-icon class="credential-icon">business</mat-icon>
                <div>
                  <strong>Provider:</strong> provider@dulux.com / password123
                </div>
              </div>
              <div class="credential-item">
                <mat-icon class="credential-icon">manage_accounts</mat-icon>
                <div>
                  <strong>Manager:</strong> manager@jotun.com / password123
                </div>
              </div>
            </div>
          </div>
        </mat-card-footer>
      </mat-card>
    </div>
  }

  <!-- Main App Content -->
  @if (isAuthenticated()) {
    <!-- Material Toolbar -->
    <mat-toolbar color="primary" class="app-toolbar">
      <button mat-icon-button (click)="toggleSidebar()" class="menu-button">
        <mat-icon>menu</mat-icon>
      </button>
      
      <span class="app-title">{{ title() }}</span>
      
      <span class="spacer"></span>
      
      <div class="user-info">
        <div class="user-avatar">{{ currentUser()?.firstName?.charAt(0) }}{{ currentUser()?.lastName?.charAt(0) }}</div>
        <div class="user-details">
          <span class="user-name">{{ currentUser()?.firstName }} {{ currentUser()?.lastName }}</span>
          <span class="user-role">{{ currentUser()?.role }}</span>
        </div>
        <button mat-icon-button (click)="logout()" class="logout-button">
          <mat-icon>logout</mat-icon>
        </button>
      </div>
    </mat-toolbar>

    <div class="main-content">
      <!-- Material Sidenav -->
      <mat-sidenav-container class="sidenav-container">
        <mat-sidenav #sidenav [mode]="'side'" [opened]="isSidebarOpen()" class="sidenav">
          <mat-nav-list>
            @for (item of menuItems; track item.title) {
                <a mat-list-item>
                <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
                <span matListItemTitle>{{ item.title }}</span>
              </a>
            }
          </mat-nav-list>
        </mat-sidenav>

        <mat-sidenav-content class="content">
          <!-- Dashboard Content -->
          @if (getCurrentRoute() === '/dashboard') {
            <div class="dashboard-container">
              <div class="dashboard-header">
                <h2>Dashboard Overview</h2>
                <p>Welcome back! Here's what's happening with your business today.</p>
              </div>

              <!-- Metrics Cards -->
              <div class="metrics-grid">
                @for (metric of metrics; track metric.title) {
                  <mat-card class="metric-card">
                    <mat-card-content>
                      <div class="metric-content">
                        <div class="metric-icon" [style.background-color]="metric.color">
                          <mat-icon>{{ metric.icon }}</mat-icon>
                        </div>
                        <div class="metric-info">
                          <div class="metric-value">{{ metric.value }}</div>
                          <div class="metric-title">{{ metric.title }}</div>
                          <div class="metric-change" [class.positive]="metric.change > 0" [class.negative]="metric.change < 0">
                            {{ metric.change > 0 ? '+' : '' }}{{ metric.change }}% vs last month
                          </div>
                        </div>
                      </div>
                    </mat-card-content>
                  </mat-card>
                }
              </div>

              <!-- Quick Actions -->
              <mat-card class="quick-actions-card">
                <mat-card-header>
                  <mat-card-title>Quick Actions</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="actions-grid">
                    <button mat-raised-button color="primary" class="action-button">
                      <mat-icon>add</mat-icon>
                      Add Product
                    </button>
                    <button mat-raised-button color="accent" class="action-button">
                      <mat-icon>calculate</mat-icon>
                      Coverage Calculator
                    </button>
                    <button mat-raised-button color="warn" class="action-button">
                      <mat-icon>local_shipping</mat-icon>
                      Manage Shipping
                    </button>
                    <button mat-raised-button class="action-button">
                      <mat-icon>analytics</mat-icon>
                      View Reports
                    </button>
                  </div>
                </mat-card-content>
              </mat-card>

              <!-- Recent Orders & Low Stock -->
              <div class="dashboard-grid">
                <!-- Recent Orders -->
                <mat-card class="dashboard-card">
                  <mat-card-header>
                    <mat-card-title>Recent Orders</mat-card-title>
                    <button mat-icon-button>
                      <mat-icon>add</mat-icon>
                    </button>
                  </mat-card-header>
                  <mat-card-content>
                    <div class="orders-list">
                      @for (order of recentOrders; track order.id) {
                        <div class="order-item">
                          <div class="order-info">
                            <div class="order-id">#{{ order.id }}</div>
                            <div class="order-customer">{{ order.customer }}</div>
                            <div class="order-date">{{ order.date }}</div>
                          </div>
                          <div class="order-amount">{{ formatCurrency(order.amount) }}</div>
                          <div class="order-status">
                            <mat-chip [class]="getStatusClass(order.status)">
                              {{ getStatusText(order.status) }}
                            </mat-chip>
                          </div>
                        </div>
                      }
                    </div>
                  </mat-card-content>
                </mat-card>

                <!-- Low Stock Alerts -->
                <mat-card class="dashboard-card">
                  <mat-card-header>
                    <mat-card-title>Low Stock Alerts</mat-card-title>
                    <button mat-icon-button>
                      <mat-icon>category</mat-icon>
                    </button>
                  </mat-card-header>
                  <mat-card-content>
                    <div class="alerts-list">
                      @for (product of lowStockProducts; track product.name) {
                        <div class="alert-item">
                          <mat-icon class="alert-icon">inventory</mat-icon>
                          <div class="alert-content">
                            <div class="alert-title">{{ product.name }}</div>
                            <div class="alert-message">Only {{ product.stock }} units remaining</div>
                          </div>
                          <button mat-icon-button>
                            <mat-icon>check_circle</mat-icon>
                          </button>
                        </div>
                      }
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </div>
          } @else if (getCurrentRoute() === '/products') {
            <!-- Product Management Content -->
            <div class="product-management">
              <div class="page-header">
                <h2>Product Management</h2>
                <div class="header-actions">
                  <button mat-raised-button color="primary">
                    <mat-icon>add</mat-icon>
                    Add Product
                  </button>
                  <button mat-raised-button>
                    <mat-icon>local_offer</mat-icon>
                    Bulk Import
                  </button>
                </div>
              </div>

              <!-- Product Statistics -->
              <div class="stats-grid">
                <mat-card class="stat-card">
                  <mat-card-content>
                    <div class="stat-content">
                      <div class="stat-icon" style="background-color: #3b82f6">
                        <mat-icon>attach_money</mat-icon>
                      </div>
                      <div class="stat-info">
                        <div class="stat-value">{{ products.length }}</div>
                        <div class="stat-label">Total Products</div>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
                
                <mat-card class="stat-card">
                  <mat-card-content>
                    <div class="stat-content">
                      <div class="stat-icon" style="background-color: #10b981">
                        <mat-icon>local_offer</mat-icon>
                      </div>
                      <div class="stat-info">
                        <div class="stat-value">{{ categories.length }}</div>
                        <div class="stat-label">Categories</div>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
                
                <mat-card class="stat-card">
                  <mat-card-content>
                    <div class="stat-content">
                      <div class="stat-icon" style="background-color: #f59e0b">
                        <mat-icon>calculate</mat-icon>
                      </div>
                      <div class="stat-info">
                        <div class="stat-value">{{ getLowStockProducts().length }}</div>
                        <div class="stat-label">Low Stock</div>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
                
                <mat-card class="stat-card">
                  <mat-card-content>
                    <div class="stat-content">
                      <div class="stat-icon" style="background-color: #ef4444">
                        <mat-icon>trending_up</mat-icon>
                      </div>
                      <div class="stat-info">
                        <div class="stat-value">₫2.5M</div>
                        <div class="stat-label">Monthly Revenue</div>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>

              <!-- Product Table -->
              <mat-card class="table-card">
                <mat-card-header>
                  <mat-card-title>Products</mat-card-title>
                  <div class="table-controls">
                    <mat-form-field appearance="outline" class="search-field">
                      <mat-label>Search products</mat-label>
                      <input matInput placeholder="Search...">
                      <mat-icon matSuffix>search</mat-icon>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="filter-field">
                      <mat-label>Category</mat-label>
                      <mat-select>
                        <mat-option value="">All Categories</mat-option>
                        @for (category of categories; track category.name) {
                          <mat-option [value]="category.name">{{ category.name }}</mat-option>
                        }
                      </mat-select>
                    </mat-form-field>
                  </div>
                </mat-card-header>
                <mat-card-content>
                  @if (loading()) {
                    <div class="loading-container">
                      <mat-spinner></mat-spinner>
                      <p>Loading products...</p>
                    </div>
                  } @else if (error()) {
                    <div class="error-container">
                      <mat-icon>error</mat-icon>
                      <p>{{ error() }}</p>
                      <button mat-raised-button color="primary" (click)="loadProducts()">
                        <mat-icon>refresh</mat-icon>
                        Retry
                      </button>
                    </div>
                  } @else {
                    <div class="table-container">
                      <table mat-table [dataSource]="products()" class="products-table">
                      <!-- Product Column -->
                      <ng-container matColumnDef="product">
                        <th mat-header-cell *matHeaderCellDef>Product</th>
                        <td mat-cell *matCellDef="let product">
                          <div class="product-info">
                            <div class="product-name">{{ product.name }}</div>
                            <div class="product-sku">SKU: {{ product.sku }}</div>
                          </div>
                        </td>
                      </ng-container>

                      <!-- Category Column -->
                      <ng-container matColumnDef="category">
                        <th mat-header-cell *matHeaderCellDef>Category</th>
                        <td mat-cell *matCellDef="let product">
                          <mat-chip>{{ product.category.name }}</mat-chip>
                        </td>
                      </ng-container>

                      <!-- Brand Column -->
                      <ng-container matColumnDef="brand">
                        <th mat-header-cell *matHeaderCellDef>Brand</th>
                        <td mat-cell *matCellDef="let product">
                          <mat-chip>{{ product.brand }}</mat-chip>
                        </td>
                      </ng-container>

                      <!-- Price Column -->
                      <ng-container matColumnDef="price">
                        <th mat-header-cell *matHeaderCellDef>Price</th>
                        <td mat-cell *matCellDef="let product">
                          {{ formatCurrency(product.price) }}
                        </td>
                      </ng-container>

                      <!-- Coverage Column -->
                      <ng-container matColumnDef="coverage">
                        <th mat-header-cell *matHeaderCellDef>Coverage</th>
                        <td mat-cell *matCellDef="let product">
                          <div class="coverage-info">
                            <span class="coverage-value">{{ product.coverage }} m²/liter</span>
                          </div>
                        </td>
                      </ng-container>

                      <!-- Status Column -->
                      <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef>Status</th>
                        <td mat-cell *matCellDef="let product">
                          <mat-chip [class]="product.isActive ? 'active' : 'inactive'">
                            {{ product.isActive ? 'Active' : 'Inactive' }}
                          </mat-chip>
                        </td>
                      </ng-container>

                      <!-- Actions Column -->
                      <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>Actions</th>
                        <td mat-cell *matCellDef="let product">
                          <div class="action-buttons">
                            <button mat-icon-button title="Edit">
                              <mat-icon>edit</mat-icon>
                            </button>
                            <button mat-icon-button (click)="toggleProductStatus(product)" [title]="product.isActive ? 'Deactivate' : 'Activate'">
                              <mat-icon>{{ product.isActive ? 'visibility_off' : 'visibility' }}</mat-icon>
                            </button>
                            <button mat-icon-button title="Delete">
                              <mat-icon>delete</mat-icon>
                            </button>
                          </div>
                        </td>
                      </ng-container>

                      <tr mat-header-row *matHeaderRowDef="['product', 'category', 'brand', 'price', 'coverage', 'status', 'actions']"></tr>
                      <tr mat-row *matRowDef="let row; columns: ['product', 'category', 'brand', 'price', 'coverage', 'status', 'actions'];"></tr>
                    </table>
                    </div>
                  }
                </mat-card-content>
              </mat-card>
            </div>
          } @else if (getCurrentRoute() === '/pricing') {
            <!-- Pricing Management Content -->
            <div class="pricing-management">
              <div class="page-header">
                <h2>Pricing Management</h2>
                <div class="header-actions">
                  <button mat-raised-button color="primary">
                    <mat-icon>add</mat-icon>
                    Add Pricing Rule
                  </button>
                  <button mat-raised-button>
                    <mat-icon>local_offer</mat-icon>
                    Bulk Update
                  </button>
                </div>
              </div>

              <!-- Coverage Calculator -->
              <mat-card class="calculator-card">
                <mat-card-header>
                  <mat-card-title>Coverage Calculator</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="calculator-container">
                    <div class="calculator-form">
                      <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Surface Type</mat-label>
                        <mat-select 
                          [(ngModel)]="coverageCalculator.surfaceType"
                          (selectionChange)="onSurfaceTypeChange()"
                          name="surfaceType">
                          @for (type of surfaceTypes; track type.value) {
                            <mat-option [value]="type.value">{{ type.label }}</mat-option>
                          }
                        </mat-select>
                      </mat-form-field>
                      
                      <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Product</mat-label>
                        <mat-select 
                          [(ngModel)]="coverageCalculator.selectedProduct"
                          (selectionChange)="onProductChange()"
                          name="selectedProduct">
                          <mat-option [value]="null">Select a product</mat-option>
                          @for (product of products(); track product.id) {
                            <mat-option [value]="product">{{ product.name }}</mat-option>
                          }
                        </mat-select>
                      </mat-form-field>
                      
                      <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Area (m²)</mat-label>
                        <input 
                          matInput
                          type="number" 
                          [(ngModel)]="coverageCalculator.area"
                          (input)="onAreaChange()"
                          placeholder="Enter area"
                          name="area">
                      </mat-form-field>
                      
                      <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Number of Coats</mat-label>
                        <input 
                          matInput
                          type="number" 
                          [(ngModel)]="coverageCalculator.coatsRequired"
                          (input)="onCoatsChange()"
                          min="1"
                          max="3"
                          name="coats">
                      </mat-form-field>
                    </div>
                    
                    <div class="calculator-result">
                      <h4>Calculation Result</h4>
                      @if (coverageCalculator.result) {
                        <div class="result-item">
                          <span class="result-label">Coverage Rate:</span>
                          <span class="result-value">{{ coverageCalculator.result.coverageRate }} m²/liter</span>
                        </div>
                        <div class="result-item">
                          <span class="result-label">Paint Needed:</span>
                          <span class="result-value">{{ coverageCalculator.result.paintNeeded }} liters</span>
                        </div>
                        <div class="result-item">
                          <span class="result-label">Product Price:</span>
                          <span class="result-value">{{ formatCurrency(coverageCalculator.result.productPrice) }}</span>
                        </div>
                        <div class="result-item total">
                          <span class="result-label">Total Cost:</span>
                          <span class="result-value">{{ formatCurrency(coverageCalculator.result.totalCost) }}</span>
                        </div>
                      } @else {
                        <p>Please select a product and enter area to calculate coverage.</p>
                      }
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          } @else {
            <!-- Coming Soon for other routes -->
            <mat-card class="coming-soon-card">
              <mat-card-content>
                <div class="coming-soon">
                  <mat-icon class="coming-soon-icon">construction</mat-icon>
                  <h3>Coming Soon</h3>
                  <p>This module is under development. Check back soon for updates!</p>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </mat-sidenav-content>
      </mat-sidenav-container>
    </div>
  } @else {
    <!-- Welcome Screen for Non-Authenticated Users -->
    <div class="welcome-screen">
      <mat-card class="welcome-card">
        <mat-card-header>
          <mat-card-title class="welcome-title">
            <mat-icon class="welcome-icon">business</mat-icon>
            Welcome to VNCompare Backoffice
          </mat-card-title>
          <mat-card-subtitle>Your comprehensive paint supplier management platform</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <div class="welcome-features">
            <mat-card class="feature-card">
              <mat-card-content>
                <div class="feature-content">
                  <mat-icon class="feature-icon">inventory</mat-icon>
                  <h3>Product Management</h3>
                  <p>Manage your paint products, categories, and inventory with ease</p>
                </div>
              </mat-card-content>
            </mat-card>
            
            <mat-card class="feature-card">
              <mat-card-content>
                <div class="feature-content">
                  <mat-icon class="feature-icon">calculate</mat-icon>
                  <h3>Coverage Calculator</h3>
                  <p>Calculate accurate paint coverage and pricing for your customers</p>
                </div>
              </mat-card-content>
            </mat-card>
            
            <mat-card class="feature-card">
              <mat-card-content>
                <div class="feature-content">
                  <mat-icon class="feature-icon">analytics</mat-icon>
                  <h3>Analytics & Reports</h3>
                  <p>Track sales performance and business insights</p>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-card-content>
        
        <mat-card-actions>
          <button 
            mat-raised-button 
            color="primary" 
            class="welcome-button"
            (click)="showLogin()">
            <mat-icon>login</mat-icon>
            Sign In to Continue
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  }
</div>