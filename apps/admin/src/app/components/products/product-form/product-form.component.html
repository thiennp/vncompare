<div class="product-form-container">
  <h2 mat-dialog-title>
    {{ isEditMode ? 'Chỉnh sửa sản phẩm' : 'Thêm sản phẩm mới' }}
  </h2>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
    <mat-dialog-content>
      <div class="form-grid">
        <!-- Basic Information -->
        <div class="form-section">
          <h3>Thông tin cơ bản</h3>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Tên sản phẩm</mat-label>
            <input matInput formControlName="name" placeholder="Nhập tên sản phẩm">
            <mat-error *ngIf="productForm.get('name')?.hasError('required')">
              {{ getErrorMessage('name') }}
            </mat-error>
            <mat-error *ngIf="productForm.get('name')?.hasError('minlength')">
              {{ getErrorMessage('name') }}
            </mat-error>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Thương hiệu</mat-label>
              <mat-select formControlName="brand">
                <mat-option *ngFor="let brand of brands" [value]="brand">
                  {{ brand }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="productForm.get('brand')?.hasError('required')">
                {{ getErrorMessage('brand') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Danh mục</mat-label>
              <mat-select formControlName="category">
                <mat-option *ngFor="let category of categories" [value]="category">
                  {{ category }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="productForm.get('category')?.hasError('required')">
                {{ getErrorMessage('category') }}
              </mat-error>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Mô tả</mat-label>
            <textarea matInput formControlName="description" rows="3" 
                      placeholder="Mô tả chi tiết về sản phẩm"></textarea>
            <mat-error *ngIf="productForm.get('description')?.hasError('required')">
              {{ getErrorMessage('description') }}
            </mat-error>
            <mat-error *ngIf="productForm.get('description')?.hasError('minlength')">
              {{ getErrorMessage('description') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Pricing Information -->
        <div class="form-section">
          <h3>Thông tin giá</h3>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Giá cơ bản (VND)</mat-label>
              <input matInput type="number" formControlName="basePrice" 
                     placeholder="0">
              <mat-error *ngIf="productForm.get('basePrice')?.hasError('required')">
                {{ getErrorMessage('basePrice') }}
              </mat-error>
              <mat-error *ngIf="productForm.get('basePrice')?.hasError('min')">
                {{ getErrorMessage('basePrice') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Giá gốc (VND)</mat-label>
              <input matInput type="number" formControlName="originalPrice" 
                     placeholder="0">
              <mat-error *ngIf="productForm.get('originalPrice')?.hasError('required')">
                {{ getErrorMessage('originalPrice') }}
              </mat-error>
              <mat-error *ngIf="productForm.get('originalPrice')?.hasError('min')">
                {{ getErrorMessage('originalPrice') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="savings-info" *ngIf="productForm.get('basePrice')?.value && productForm.get('originalPrice')?.value">
            <mat-chip color="accent" selected>
              Tiết kiệm: {{ calculateSavings() | number:'1.1-1' }}%
            </mat-chip>
          </div>
        </div>

        <!-- Coverage Information -->
        <div class="form-section">
          <h3>Thông tin độ phủ</h3>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Độ phủ (m²/lít)</mat-label>
              <input matInput type="number" formControlName="coverageRate" 
                     placeholder="0.0" step="0.1">
              <mat-error *ngIf="productForm.get('coverageRate')?.hasError('required')">
                {{ getErrorMessage('coverageRate') }}
              </mat-error>
              <mat-error *ngIf="productForm.get('coverageRate')?.hasError('min')">
                {{ getErrorMessage('coverageRate') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Đơn vị</mat-label>
              <mat-select formControlName="unit">
                <mat-option *ngFor="let unit of units" [value]="unit">
                  {{ unit }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="productForm.get('unit')?.hasError('required')">
                {{ getErrorMessage('unit') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Status -->
        <div class="form-section">
          <h3>Trạng thái</h3>
          
          <mat-slide-toggle formControlName="isActive" color="primary">
            {{ productForm.get('isActive')?.value ? 'Hoạt động' : 'Không hoạt động' }}
          </mat-slide-toggle>
        </div>
      </div>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button type="button" (click)="onCancel()">
        Hủy
      </button>
      <button mat-raised-button color="primary" type="submit" 
              [disabled]="productForm.invalid">
        {{ isEditMode ? 'Cập nhật' : 'Thêm sản phẩm' }}
      </button>
    </mat-dialog-actions>
  </form>
</div>
